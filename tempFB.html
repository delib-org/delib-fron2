<!DOCTYPE html>
<html>
  <head>
    <title>Temp FB</title>
    <script type="text/javascript" src="js/firebase.js"></script>
  </head>
  <body>
    <script>
      const DB = new Firebase("https://synthesistalyaron.firebaseio.com/");
      
      const carsDB = DB.child("cars");
      const usersDB = DB.child("users");
      
      carsDB.orderByChild("price").on("value", function(data){
        console.log(JSON.stringify(data.val()));
        data.forEach(function(data2){
          console.log("a: "+data2.key());
        })
      })
      
      var userDB = DB.child('users/-KIUArWGBpO4c2t5m-5c');
      
      //update groups details every time the user changes his groups
      
      userDB.child("role").on("value", function(groupsOwned){
        var userOwndGroupsArr = [];

        //start counting the number of groups.
        var groupsOwnedLng = groupsOwned.val();
        var numberOfGroups = Object.keys(groupsOwnedLng).length;
        var i = 1;

        groupsOwned.forEach(function(groupOwned){
          var isGroupOwned = groupOwned.val();
          if (isGroupOwned == "owner"){

            DB.child("groups/"+groupOwned.key()).once("value", function(data){
              var title = data.val().title;
              var description = data.val().description;

              userOwndGroupsArr.push({uuid: groupOwned.key(), title: title,description: description });

              if (i === numberOfGroups){
                console.log("total 4: " + JSON.stringify(userOwndGroupsArr));
              }
              i++; 
            })
          }
        })
      })
      
      
      
      function addMember(firstName, lastName, member){
        jsonMember = {};
        jsonMember[member]=true;
        usersDB.push({first_name: firstName, last_name: lastName,owner:jsonMember});
      }

    </script>
  </body>
</html>
